<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Invoice Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container {
      width: 50%;
      max-width: 500px;
      background: #fff;
      padding: 10px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      border-radius: 5px;
      overflow-y: auto;
    }
    h2, h3 {
      text-align: center;
      color: #333;
      margin: 5px 0;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 5px;
    }
    input, button {
      width: 100%;
      padding: 8px;
      margin-top: 3px;
      border: 1px solid #ccc;
      border-radius: 3px;
      box-sizing: border-box;
    }
    button {
      background-color: #28a745;
      color: white;
      font-size: 14px;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background-color: #218838;
    }
    .item-container {
      display: flex;
      gap: 3px;
      align-items: center;
      margin-top: 5px;
    }
    .remove-btn {
      background-color: #dc3545;
      width: auto;
      font-size: 12px;
      padding: 5px;
    }
    .remove-btn:hover {
      background-color: #c82333;
    }
  </style>
  <script>
    function addItem() {
      let container = document.getElementById("items-container");
      let div = document.createElement("div");
      div.classList.add("item-container");
      div.innerHTML = `
        <input type="text" name="item_name[]" placeholder="Item" required style="flex:2;">
        <input type="number" step="0.01" name="price[]" placeholder="Price/kg" required style="flex:1;">
        <input type="number" step="0.01" name="quantity[]" placeholder="Qty (kg)" required style="flex:1;">
        <button type="button" class="remove-btn" onclick="this.parentElement.remove()">X</button>
      `;
      container.appendChild(div);
    }

    function validateForm() {
      const gst = document.querySelector('[name="gst_number"]').value.trim();
      const contact = document.querySelector('[name="contact"]').value.trim();

      const gstPattern = /^\d{2}[A-Z]{5}\d{4}[A-Z]{1}[A-Z\d]{1}Z[A-Z\d]{1}$/;
      const contactPattern = /^[6-9]\d{9}$/;

      if (gst.length !== 15) {
        alert("GST Number must be exactly 15 characters long.");
        return false;
      }

      if (!gstPattern.test(gst)) {
        alert("Invalid GST Number format! It should match: 22AAAAA0000A1Z1");
        return false;
      }

      if (!contactPattern.test(contact)) {
        alert("Invalid Contact Number! It must be a 10-digit number starting with 6, 7, 8, or 9.");
        return false;
      }

      return true;
    }

    function restrictContactInput(e) {
      const key = e.key;
      const value = e.target.value;

      // Allow only digits and max 10 characters
      if (!/^\d$/.test(key) || value.length >= 10) {
        e.preventDefault();
      }
    }

    function limitContactPaste(e) {
      const pasteData = (e.clipboardData || window.clipboardData).getData('text');
      if (!/^\d{1,10}$/.test(pasteData)) {
        e.preventDefault();
        alert("Only numeric values (max 10 digits) are allowed for Contact Number.");
      }
    }
  </script>
</head>
<body>
  <div class="container">
    <h2>Invoice Generator</h2>
    <form action="/" method="POST" enctype="multipart/form-data" onsubmit="return validateForm()">
      <label>Company Name:</label>
      <input type="text" name="company_name" required />

      <label>Address:</label>
      <input type="text" name="address" required />

      <label>City:</label>
      <input type="text" name="city" required />

      <label>GST Number:</label>
      <input type="text" name="gst_number" maxlength="15" required placeholder="eg : 22AAAAA0000A1Z1"
             title="Enter a valid 15-character GST number" />

      <label>Date:</label>
      <input type="date" name="date" required />

      <label>Contact:</label>
      <input type="text" name="contact" maxlength="10" required placeholder="eg: 9876543210"
             title="Enter a valid 10-digit contact number"
             onkeypress="restrictContactInput(event)"
             onpaste="limitContactPaste(event)" />

      <label>Customer Name:</label>
      <input type="text" name="customer_name" required />

      <label>Authorized Signatory:</label>
      <input type="text" name="authorized_signatory" required />

      <label>Company Logo:</label>
      <input type="file" name="logo" />

      <h3>Items</h3>
      <div id="items-container"></div>
      <button type="button" onclick="addItem()">Add Item</button>

      <button type="submit">Generate Invoice</button>
    </form>
  </div>
</body>
</html>
